<form [formGroup]="versionForm" (ngSubmit)="submit()">
	<nb-card class="dialog-card" status="basic">
		<nb-card-header class="mb-0">
			<h5 class="title">
				{{
					version
						? ('PLUGIN.DIALOG.VERSION.UPDATE.TITLE' | translate : { number: version.number })
						: ('PLUGIN.DIALOG.VERSION.CREATE.TITLE' | translate : { name: plugin?.name })
				}}
			</h5>
			<span class="cancel"><i (click)="dismiss()" class="fas fa-times"></i></span>
		</nb-card-header>
		<nb-card-body>
			<!-- Version -->
			<lib-plugin-version class="grow" [form]="versionForm"></lib-plugin-version>
			<!-- Source -->
			<div class="sources-container grow">
				@for(source of sources.controls; track source; let idx = $index){
				<div class="source-card" [formGroupName]="idx">
					<div class="source-header">
						<h5>{{ 'PLUGIN.FORM.SOURCE' | translate }} #{{ idx + 1 }}</h5>
						@if(sources.length > 1){
						<button nbButton ghost status="danger" size="small" (click)="removeSource(idx)">
							<nb-icon icon="trash-2-outline"></nb-icon>
						</button>
						}
					</div>
					<lib-plugin-source class="grow" [form]="source"></lib-plugin-source>
				</div>
				} @empty {
				<ngx-no-data-message message="Add at least one source"></ngx-no-data-message>
				}
				<div class="add-source">
					<nb-select [(selected)]="selectedSourceType" placeholder="Select Source Type">
						@for(source of sourceTypes; track source){
						<nb-option [value]="source">
							{{ 'PLUGIN.FORM.SOURCE_TYPES.' + source | translate }}
						</nb-option>
						}
					</nb-select>
					<button
						nbButton
						outline
						status="primary"
						[disabled]="!selectedSourceType"
						(click)="addSource(selectedSourceType)"
					>
						<nb-icon icon="plus-outline"></nb-icon> {{ 'Add Source' | translate }}
					</button>
				</div>
			</div>
		</nb-card-body>
		<nb-card-footer class="text-right mt-0">
			<button nbButton type="button" (click)="dismiss()" outline status="basic">
				{{ 'BUTTONS.CANCEL' | translate }}
			</button>
			<button
				nbButton
				type="submit"
				status="success"
				[disabled]="isFormInvalid || isSubmitting"
				[nbSpinner]="isSubmitting"
				nbSpinnerStatus="success"
				nbSpinnerSize="small"
			>
				{{
					version
						? ('BUTTONS.UPDATE' | translate)
						: ('BUTTONS.CREATE' | translate) + (versionNumber ? ' v' + versionNumber : '')
				}}
			</button>
		</nb-card-footer>
	</nb-card>
</form>
