<nb-card class="dialog-card" status="basic">
	<nb-card-header class="mb-0">
		<h5 class="title">{{ (!!plugin ? 'POP_UPS.EDIT' : 'PLUGIN.FORM.TITLE') | translate }}</h5>
		<span class="cancel"><i (click)="dismiss()" class="fas fa-times"></i></span>
	</nb-card-header>

	<nb-card-body>
		<form [formGroup]="pluginForm" (ngSubmit)="submit()">
			<nb-stepper orientation="horizontal" #stepper>
				<!-- Step 1: Basic Info -->
				<nb-step [stepControl]="pluginForm?.get('name')" [label]="'PLUGIN.FORM.BASIC_INFO' | translate">
					<lib-plugin-basic-information
						[form]="pluginForm"
						[pluginTypes]="pluginTypes"
						[pluginStatuses]="pluginStatuses"
						class="grow"
					></lib-plugin-basic-information>
					<div class="stepper-buttons">
						<button nbButton status="primary" nbStepperNext>{{ 'BUTTONS.NEXT' | translate }}</button>
					</div>
				</nb-step>

				<!-- Step 2: Source -->
				<nb-step [stepControl]="pluginForm?.get('version.sources')" [label]="'PLUGIN.FORM.SOURCE' | translate">
					<div class="sources-container">
						@for(source of sources.controls; track source; let idx = $index){
						<div class="source-card" [formGroup]="source">
							<div class="source-header">
								<h5>{{ 'PLUGIN.FORM.SOURCE' | translate }} #{{ idx + 1 }}</h5>
								<button
									nbButton
									ghost
									status="danger"
									size="small"
									(click)="removeSource(idx)"
									*ngIf="sources.length > 1"
								>
									<nb-icon icon="trash-2-outline"></nb-icon>
								</button>
							</div>
							<lib-plugin-source
								class="grow"
								[form]="pluginForm?.get('version.source')"
							></lib-plugin-source>
						</div>
						<div class="add-source">
							<nb-select [(ngModel)]="selectedSourceType" placeholder="Select Source Type">
								<nb-option *ngFor="let source of sourceTypes" [value]="source">
									{{ 'PLUGIN.FORM.SOURCE_TYPES.' + source | translate }}
								</nb-option>
							</nb-select>
							<button nbButton outline status="primary" (click)="addSource()">
								<nb-icon icon="plus-outline"></nb-icon> {{ 'PLUGIN.FORM.ADD_SOURCE' | translate }}
							</button>
						</div>
						}
					</div>
					<div class="stepper-buttons">
						<button nbButton outline status="basic" nbStepperPrevious>
							{{ 'BUTTONS.PREVIOUS' | translate }}
						</button>
						<button nbButton status="primary" nbStepperNext>{{ 'BUTTONS.NEXT' | translate }}</button>
					</div>
				</nb-step>

				<!-- Step 3: Version -->
				<nb-step [stepControl]="pluginForm?.get('version')" [label]="'PLUGIN.FORM.VERSION' | translate">
					<lib-plugin-version class="grow" [form]="pluginForm?.get('version')"></lib-plugin-version>
					<div class="stepper-buttons">
						<button nbButton outline status="basic" nbStepperPrevious>
							{{ 'BUTTONS.PREVIOUS' | translate }}
						</button>
						<button nbButton status="primary" nbStepperNext>{{ 'BUTTONS.NEXT' | translate }}</button>
					</div>
				</nb-step>

				<!-- Step 4: Metadata -->
				<nb-step [label]="'PLUGIN.FORM.METADATA' | translate">
					<lib-plugin-metadata class="grow" [form]="pluginForm"></lib-plugin-metadata>
					<div class="stepper-buttons">
						<button nbButton outline status="basic" nbStepperPrevious>
							{{ 'BUTTONS.PREVIOUS' | translate }}
						</button>
						<button nbButton type="button" (click)="dismiss()" outline status="danger">
							{{ 'BUTTONS.CANCEL' | translate }}
						</button>
						<button
							nbButton
							type="submit"
							status="success"
							[disabled]="isFormInvalid || isSubmitting"
							[nbSpinner]="isSubmitting"
							nbSpinnerStatus="success"
							nbSpinnerSize="small"
						>
							{{ (!!plugin ? 'BUTTONS.UPDATE' : 'BUTTONS.UPLOAD') | translate }}
						</button>
					</div>
				</nb-step>
			</nb-stepper>
		</form>
	</nb-card-body>
</nb-card>
