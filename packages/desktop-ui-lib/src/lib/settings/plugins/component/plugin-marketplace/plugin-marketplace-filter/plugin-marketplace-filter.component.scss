.marketplace-filter {
	background: var(--card-background-color);
	border: 1px solid var(--card-divider-color);
	border-radius: var(--card-border-radius);
	overflow: hidden;
	transition: all 0.3s ease;
	position: relative;

	&.collapsed {
		.filter-content {
			display: none;
		}
	}

	&.mobile {
		border-radius: 0;
		border-left: none;
		border-right: none;

		.filter-header {
			padding: 0.75rem 1rem;
		}

		.filter-content {
			padding: 0 1rem 1rem;
		}
	}

	// Filter Header
	.filter-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		background: var(--gauzy-card-1);
		border-bottom: 1px solid var(--card-divider-color);
		padding: 1rem;
		position: sticky;
		top: 0;
		z-index: 2;
		backdrop-filter: saturate(180%) blur(6px);
		/* Ensure sticky header overlays section content smoothly */
		background-clip: padding-box;

		.header-content {
			display: flex;
			align-items: center;
			gap: 1rem;
			flex: 1;

			.filter-title {
				display: flex;
				align-items: center;
				gap: 0.5rem;
				position: relative;

				nb-icon {
					color: var(--text-hint-color);
					font-size: 1.25rem;
				}

				h4 {
					margin: 0;
					font-size: 1.125rem;
					font-weight: 600;
					color: var(--text-basic-color);
				}

				.active-filters-badge {
					position: relative;
					margin-left: 0.5rem;
				}
			}
		}

		.header-actions {
			display: flex;
			gap: 0.5rem;
			align-items: center;

			.collapse-toggle {
				transition: transform 0.2s ease;

				&:hover {
					transform: scale(1.1);
				}
			}
		}
	}

	// Filter Content
	.filter-content {
		/* Limit inner scrolling to large screens only; allow natural page scroll elsewhere */
		max-height: 80vh;
		overflow-y: auto;
		scroll-padding-top: 72px; /* account for sticky header height */

		&::-webkit-scrollbar {
			width: 6px;
		}

		&::-webkit-scrollbar-track {
			background: var(--background-basic-color-2);
			border-radius: 3px;
		}

		&::-webkit-scrollbar-thumb {
			background: var(--background-basic-color-4);
			border-radius: 3px;

			&:hover {
				background: var(--background-basic-color-3);
			}
		}
	}

	.filter-form {
		display: flex;
		flex-direction: column;
	}

	// Filter Sections
	.filter-section {
		border: 1px solid var(--card-divider-color);
		overflow: hidden;
		transition: all 0.2s ease;
		background: var(--card-background-color);

		&.expanded {
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
		}

		.section-header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			padding: 0.75rem 1rem;
			background: var(--gauzy-card-1);
			cursor: pointer;
			/* button reset */
			border: none;
			width: 100%;
			text-align: left;
			appearance: none;
			transition: background-color 0.2s ease;

			&:hover {
				background: var(--background-basic-color-3);
			}

			.section-title {
				display: flex;
				align-items: center;
				gap: 0.5rem;
				font-weight: 600;
				color: var(--gauzy-text-color-1);

				nb-icon {
					color: var(--text-hint-color);
				}
			}

			.section-toggle {
				color: var(--text-hint-color);
				transition: transform 0.2s ease;
			}
		}

		.section-content {
			padding: 1rem;
			background: var(--card-background-color);
			border-top: 1px solid var(--card-divider-color);
		}
	}

	// Form Elements
	.form-group {
		margin-bottom: 1.5rem;

		&:last-child {
			margin-bottom: 0;
		}

		.form-label {
			display: block;
			margin-bottom: 0.5rem;
			font-weight: 600;
			color: var(--text-basic-color);
			font-size: 0.875rem;
		}

		nb-form-field {
			width: 100%;
		}
	}

	// Sort Controls
	.sort-controls {
		display: flex;
		gap: 0.75rem;
		align-items: stretch;

		nb-select {
			flex: 1;
		}

		nb-button-group {
			max-height: 32px;
			flex-shrink: 0;
		}
	}

	// Categories Loading State
	.categories-loading,
	.categories-loading-more {
		display: flex;
		align-items: center;
		justify-content: center;
		gap: 0.75rem;
		padding: 1.5rem;
		color: var(--text-hint-color);

		.loading-text {
			font-size: 0.875rem;
		}
	}

	.categories-loading-more {
		padding: 1rem;
		border-top: 1px solid var(--card-divider-color);
	}

	// Categories Empty State
	.categories-empty {
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		gap: 0.75rem;
		padding: 2rem;
		text-align: center;

		.empty-icon {
			font-size: 2.5rem;
			color: var(--text-disabled-color);
		}

		.empty-text {
			margin: 0;
			color: var(--text-hint-color);
			font-size: 0.875rem;
		}
	}

	// Categories End Indicator
	.categories-end {
		display: flex;
		align-items: center;
		justify-content: center;
		padding: 1rem;
		border-top: 1px solid var(--card-divider-color);

		.end-text {
			font-size: 0.75rem;
			color: var(--text-hint-color);
			font-style: italic;
		}
	}

	// Categories Grid Wrapper for Infinite Scroll
	.categories-grid-wrapper {
		max-height: 400px;
		overflow-y: auto;
		overflow-x: hidden;
		padding-right: 0.25rem;

		&::-webkit-scrollbar {
			width: 6px;
		}

		&::-webkit-scrollbar-track {
			background: transparent;
		}

		&::-webkit-scrollbar-thumb {
			background: var(--card-divider-color);
			border-radius: 3px;

			&:hover {
				background: var(--text-hint-color);
			}
		}
	}

	// Categories Grid
	.categories-grid {
		display: grid;
		/* Auto-fit creates modern, responsive wrapping for category chips */
		grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
		gap: 0.75rem;

		.category-item {
			display: flex;
			align-items: center;
			justify-content: space-between;
			padding: 0.75rem;
			border: 1px solid var(--card-divider-color);
			border-radius: var(--card-border-radius);
			background: var(--card-background-color);
			cursor: pointer;
			/* button reset */
			width: 100%;
			text-align: left;
			border-width: 1px;
			appearance: none;
			transition: all 0.2s ease;
			position: relative;

			&:hover {
				border-color: var(--text-primary-color);
				box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
			}

			&.selected {
				border-color: var(--status-success-color);
				background: var(--status-success-background-color);

				.category-indicator {
					color: var(--status-success-color);
				}
			}

			.category-content {
				display: flex;
				align-items: center;
				gap: 0.5rem;
				flex: 1;
				min-width: 0;

				.category-icon {
					flex-shrink: 0;
					color: var(--text-hint-color);
					font-size: 1.125rem;
				}

				.category-info {
					display: flex;
					flex-direction: column;
					min-width: 0;

					.category-name {
						font-weight: 600;
						font-size: 0.875rem;
						color: var(--text-basic-color);
						white-space: nowrap;
						overflow: hidden;
						text-overflow: ellipsis;
					}

					.category-count {
						font-size: 0.75rem;
						color: var(--text-hint-color);
					}
				}
			}

			.category-indicator {
				color: var(--status-success-color);
				font-size: 1rem;
			}
		}
	}

	// Checkbox Groups
	.checkbox-group {
		display: flex;
		flex-direction: column;
		gap: 0.5rem;

		.checkbox-item {
			display: flex;
			align-items: center;

			.checkbox-label {
				display: flex;
				align-items: center;
				gap: 0.5rem;
				margin-left: 0.5rem;
				font-size: 0.875rem;
				color: var(--text-basic-color);
			}
		}
	}

	// Price Categories
	.price-categories {
		display: flex;
		flex-wrap: wrap;
		gap: 0.5rem;

		.price-category-btn {
			text-transform: capitalize;
		}
	}

	// Price Range Controls
	.price-range-controls {
		display: flex;
		align-items: center;
		gap: 0.75rem;

		.range-input {
			flex: 1;
		}

		.range-separator {
			color: var(--text-hint-color);
			font-size: 0.875rem;
			white-space: nowrap;
		}
	}

	// Date Range Controls
	.date-range-controls {
		display: flex;
		align-items: center;
		gap: 0.75rem;

		.date-input {
			flex: 1;
		}

		.date-separator {
			color: var(--text-hint-color);
			font-size: 0.875rem;
			white-space: nowrap;
		}
	}

	// Quick Filters (Mobile)
	.quick-filters {
		padding: 1rem;
		background: var(--background-basic-color-1);
		border-top: 1px solid var(--card-divider-color);

		.quick-filter-chips {
			display: flex;
			flex-wrap: wrap;
			gap: 0.5rem;
			align-items: center;
		}
	}

	// Loading Overlay
	.filter-loading {
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background: rgba(255, 255, 255, 0.9);
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		gap: 1rem;
		z-index: 10;

		span {
			color: var(--text-hint-color);
			font-size: 0.875rem;
		}
	}

	// Responsive Design
	@media (max-width: 768px) {
		/* Disable inner scroll on small screens so the whole page scrolls */
		.filter-content {
			max-height: none;
			overflow: visible;
		}

		&:not(.mobile) {
			margin: 0 -1rem;
			border-radius: 0;
			border-left: none;
			border-right: none;
		}

		.categories-grid {
			grid-template-columns: repeat(2, 1fr);
		}

		.sort-controls {
			flex-direction: column;
			align-items: stretch;
		}

		.price-range-controls,
		.date-range-controls {
			flex-direction: column;
			align-items: stretch;

			.range-separator,
			.date-separator {
				text-align: center;
				padding: 0.25rem 0;
			}
		}

		.price-categories {
			justify-content: center;
		}

		.filter-section .section-content {
			padding: 0.75rem;
		}
	}

	@media (max-width: 480px) {
		.filter-header {
			padding: 0.75rem 1rem;

			.header-content {
				flex-direction: column;
				align-items: flex-start;
				gap: 0.5rem;
			}

			.header-actions {
				align-self: flex-end;
			}
		}

		.categories-grid .category-item {
			padding: 0.5rem;

			.category-content {
				.category-info {
					.category-name {
						font-size: 0.75rem;
					}
				}
			}
		}

		.checkbox-group {
			.checkbox-item {
				.checkbox-label {
					font-size: 0.75rem;
				}
			}
		}
	}

	// Dark theme adjustments
	@media (prefers-color-scheme: dark) {
		.filter-loading {
			background: rgba(0, 0, 0, 0.9);
		}
	}

	// High contrast mode
	@media (prefers-contrast: high) {
		border-width: 2px;

		.filter-section,
		.category-item {
			border-width: 2px;
		}

		.category-item.selected {
			border-width: 3px;
		}
	}

	// Reduced motion
	@media (prefers-reduced-motion: reduce) {
		*,
		*::before,
		*::after {
			transition: none !important;
			animation: none !important;
		}
	}

	// Print styles
	@media print {
		display: none;
	}
}

// Global overrides for form elements within filter
.marketplace-filter {
	nb-select,
	nb-form-field input,
	nb-checkbox {
		font-size: 0.875rem;
	}

	nb-tag {
		font-size: 0.75rem;
		font-weight: 500;
	}

	nb-button {
		font-size: 0.875rem;
	}

	// Custom scrollbar for select dropdowns
	nb-option-list {
		&::-webkit-scrollbar {
			width: 6px;
		}

		&::-webkit-scrollbar-track {
			background: var(--background-basic-color-2);
		}

		&::-webkit-scrollbar-thumb {
			background: var(--background-basic-color-4);
			border-radius: 3px;
		}
	}
}

// Animation for section expansion
@keyframes sectionExpand {
	from {
		opacity: 0;
		transform: translateY(-10px);
	}
	to {
		opacity: 1;
		transform: translateY(0);
	}
}

.filter-section.expanded .section-content {
	animation: sectionExpand 0.2s ease-out;
}

// Focus states
.marketplace-filter {
	button:focus,
	input:focus,
	select:focus,
	.category-item:focus {
		outline: 2px solid var(--text-primary-color);
		outline-offset: 2px;
	}

	.category-item {
		&:focus {
			border-color: var(--text-primary-color);
		}
	}
}

// Accessibility improvements
.marketplace-filter {
	[aria-disabled="true"] {
		opacity: 0.6;
		cursor: not-allowed;
	}

	[aria-expanded="true"] + .section-content {
		display: block;
	}

	[aria-expanded="false"] + .section-content {
		display: none;
	}
}
