<div class="subscription-plan-creator">
	<div class="creator-header">
		<h6>{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.TITLE' | translate }}</h6>
		<p class="text-hint">{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.DESCRIPTION' | translate }}</p>
	</div>

	<form [formGroup]="plansForm" class="plans-form">
		<div formArrayName="plans" class="plans-array">
			<!-- Plan Cards -->
			<div
				*ngFor="let planGroup of plans.controls; let planIndex = index"
				[formGroupName]="planIndex"
				class="plan-card"
			>
				<div class="plan-card-header">
					<div class="plan-title">
						<nb-icon icon="layers-outline"></nb-icon>
						<span>{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.PLAN' | translate }} {{ planIndex + 1 }}</span>
					</div>
					<div class="plan-actions">
						<button
							*ngIf="allowMultiplePlans"
							type="button"
							nbButton
							ghost
							size="tiny"
							status="basic"
							nbTooltip="{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.DUPLICATE_PLAN' | translate }}"
							(click)="duplicatePlan(planIndex)"
						>
							<nb-icon icon="copy-outline"></nb-icon>
						</button>
						<button
							*ngIf="canRemovePlan()"
							type="button"
							nbButton
							ghost
							size="tiny"
							status="danger"
							nbTooltip="{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.REMOVE_PLAN' | translate }}"
							(click)="removePlan(planIndex)"
						>
							<nb-icon icon="trash-2-outline"></nb-icon>
						</button>
					</div>
				</div>

				<div class="plan-card-body">
					<!-- Plan Type -->
					<div class="form-row">
						<nb-form-field class="form-group">
							<label class="label">{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.TYPE' | translate }} *</label>
							<nb-select
								fullWidth
								formControlName="type"
								placeholder="{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.SELECT_TYPE' | translate }}"
								(selectionChange)="onPlanTypeChange(planIndex)"
							>
								<nb-option *ngFor="let type of PluginSubscriptionType | keyvalue" [value]="type.value">
									{{ type.value | titlecase }}
								</nb-option>
							</nb-select>
						</nb-form-field>
					</div>

					<!-- Plan Name and Description -->
					<div class="form-row">
						<nb-form-field class="form-group">
							<label class="label">{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.NAME' | translate }} *</label>
							<input
								nbInput
								fullWidth
								formControlName="name"
								placeholder="{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.NAME_PLACEHOLDER' | translate }}"
							/>
						</nb-form-field>
					</div>

					<div class="form-row">
						<nb-form-field class="form-group">
							<label class="label">{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.DESCRIPTION' | translate }} *</label>
							<textarea
								nbInput
								fullWidth
								formControlName="description"
								rows="3"
								placeholder="{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.DESCRIPTION_PLACEHOLDER' | translate }}"
							></textarea>
						</nb-form-field>
					</div>

					<!-- Pricing -->
					<div class="form-row pricing-row">
						<nb-form-field class="form-group price-group">
							<label class="label">{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.PRICE' | translate }} *</label>
							<input
								nbInput
								fullWidth
								type="number"
								formControlName="price"
								min="0"
								step="0.01"
								placeholder="0.00"
							/>
						</nb-form-field>

						<nb-form-field class="form-group currency-group">
							<label class="label">{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.CURRENCY' | translate }} *</label>
							<nb-select fullWidth formControlName="currency">
								<nb-option value="USD">USD ($)</nb-option>
								<nb-option value="EUR">EUR (€)</nb-option>
								<nb-option value="GBP">GBP (£)</nb-option>
								<nb-option value="JPY">JPY (¥)</nb-option>
							</nb-select>
						</nb-form-field>

						<nb-form-field class="form-group billing-group">
							<label class="label">{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.BILLING_PERIOD' | translate }} *</label>
							<nb-select fullWidth formControlName="billingPeriod">
								<nb-option *ngFor="let period of PluginBillingPeriod | keyvalue" [value]="period.value">
									{{ formatBillingPeriod(period.value) | titlecase }}
								</nb-option>
							</nb-select>
						</nb-form-field>
					</div>

					<!-- Price Preview -->
					<div class="price-preview" *ngIf="planGroup.get('price')?.value >= 0">
						<nb-alert status="info" size="small">
							<strong>{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.PRICE_PREVIEW' | translate }}:</strong>
							<span *ngIf="planGroup.get('price')?.value === 0">
								{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.FREE' | translate }}
							</span>
							<span *ngIf="planGroup.get('price')?.value > 0">
								{{ formatCurrency(planGroup.get('price')?.value, planGroup.get('currency')?.value) }}
								/ {{ formatBillingPeriod(planGroup.get('billingPeriod')?.value) }}
							</span>
						</nb-alert>
					</div>

					<!-- Features -->
					<div class="form-section">
						<div class="section-header">
							<label class="label">{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.FEATURES' | translate }} *</label>
							<button
								type="button"
								nbButton
								ghost
								size="tiny"
								status="success"
								(click)="addFeature(planIndex)"
							>
								<nb-icon icon="plus-outline"></nb-icon>
								{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.ADD_FEATURE' | translate }}
							</button>
						</div>

						<div class="features-list">
							<div
								*ngFor="let featureControl of getPlanFeatures(planIndex).controls; let featureIndex = index"
								class="feature-item"
							>
								<nb-form-field class="feature-input">
									<input
										nbInput
										fullWidth
										[formControl]="featureControl"
										placeholder="{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.FEATURE_PLACEHOLDER' | translate }}"
									/>
								</nb-form-field>
								<button
									*ngIf="getPlanFeatures(planIndex).length > 1"
									type="button"
									nbButton
									ghost
									size="tiny"
									status="danger"
									(click)="removeFeature(planIndex, featureIndex)"
								>
									<nb-icon icon="trash-2-outline"></nb-icon>
								</button>
							</div>
						</div>
					</div>

					<!-- Limitations -->
					<div class="form-section" formGroupName="limitations">
						<label class="label section-title">{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.LIMITATIONS' | translate }}</label>
						<div class="limitations-grid">
							<nb-form-field class="form-group">
								<label class="label">{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.MAX_USERS' | translate }}</label>
								<input
									nbInput
									fullWidth
									type="number"
									formControlName="maxUsers"
									min="1"
									placeholder="{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.UNLIMITED' | translate }}"
								/>
							</nb-form-field>

							<nb-form-field class="form-group">
								<label class="label">{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.MAX_PROJECTS' | translate }}</label>
								<input
									nbInput
									fullWidth
									type="number"
									formControlName="maxProjects"
									min="1"
									placeholder="{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.UNLIMITED' | translate }}"
								/>
							</nb-form-field>

							<nb-form-field class="form-group">
								<label class="label">{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.API_CALLS' | translate }}</label>
								<input
									nbInput
									fullWidth
									type="number"
									formControlName="apiCallsPerMonth"
									min="1"
									placeholder="{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.UNLIMITED' | translate }}"
								/>
							</nb-form-field>

							<nb-form-field class="form-group">
								<label class="label">{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.STORAGE_LIMIT' | translate }}</label>
								<input
									nbInput
									fullWidth
									type="number"
									formControlName="storageLimit"
									min="1"
									placeholder="{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.UNLIMITED' | translate }}"
								/>
							</nb-form-field>
						</div>
					</div>

					<!-- Additional Options -->
					<div class="form-section">
						<label class="label section-title">{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.ADDITIONAL_OPTIONS' | translate }}</label>
						<div class="options-grid">
							<nb-form-field class="form-group">
								<label class="label">{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.TRIAL_DAYS' | translate }}</label>
								<input
									nbInput
									fullWidth
									type="number"
									formControlName="trialDays"
									min="0"
									max="365"
									placeholder="0"
								/>
							</nb-form-field>

							<nb-form-field class="form-group">
								<label class="label">{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.SETUP_FEE' | translate }}</label>
								<input
									nbInput
									fullWidth
									type="number"
									formControlName="setupFee"
									min="0"
									step="0.01"
									placeholder="0.00"
								/>
							</nb-form-field>

							<nb-form-field class="form-group">
								<label class="label">{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.DISCOUNT' | translate }}</label>
								<input
									nbInput
									fullWidth
									type="number"
									formControlName="discountPercentage"
									min="0"
									max="100"
									placeholder="0"
								/>
							</nb-form-field>
						</div>

						<div class="checkboxes-row">
							<nb-checkbox formControlName="isPopular">
								{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.POPULAR' | translate }}
							</nb-checkbox>
							<nb-checkbox formControlName="isRecommended">
								{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.RECOMMENDED' | translate }}
							</nb-checkbox>
						</div>
					</div>
				</div>
			</div>

			<!-- Add Plan Button -->
			<div *ngIf="canAddPlan()" class="add-plan-section">
				<button
					type="button"
					nbButton
					ghost
					status="primary"
					size="large"
					(click)="addPlan()"
					class="add-plan-button"
				>
					<nb-icon icon="plus-outline"></nb-icon>
					{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.ADD_PLAN' | translate }}
				</button>
			</div>

			<!-- No Plans Message -->
			<div *ngIf="plans.length === 0" class="no-plans-message">
				<nb-alert status="warning" size="small">
					<nb-icon icon="alert-triangle-outline"></nb-icon>
					{{ 'PLUGIN.FORM.SUBSCRIPTION_PLANS_CREATOR.NO_PLANS' | translate }}
				</nb-alert>
			</div>
		</div>
	</form>
</div>
